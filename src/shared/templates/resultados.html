<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reporte de Resultados {{resultado.idMuestra}}</title>
  <style>
    body { font-family: Arial, sans-serif; font-size: 10pt; margin: 50px; }
    .logo { position: absolute; top: 50px; right: 50px; width: 80px; }
    .titulo { background-color: #002D4D; color: white; text-align: center; padding: 10px; margin-bottom: 20px; font-size: 14pt; }
    .seccion { margin-bottom: 15px; }
    .seccion-titulo { background-color: #4CAF50; color: white; padding: 5px; font-weight: bold; margin-bottom: 5px; text-align: left; }
    .tabla { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .tabla th, .tabla td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .tabla th { background-color: #f2f2f2; font-weight: bold; }
    .tabla-resultados th { background-color: #4CAF50; color: white; text-align: center; }
    .tabla-resultados td { text-align: left; }
    .historial-cambios-titulo { background-color: #4CAF50; color: white; padding: 5px; font-weight: bold; margin-top: 20px; margin-bottom: 5px; }
    .cambio-detalle { margin-left: 10px; margin-bottom: 10px; border: 1px solid #eee; padding: 10px; }
    .firmas { margin-top: 40px; display: flex; justify-content: space-around; }
    .firma-box { text-align: center; min-width: 220px; }
    .footer-block { background: #4CAF50; color: #fff; font-weight: bold; padding: 10px; text-align: center; border-radius: 4px; margin-top: 40px; text-transform: uppercase; }
    .observaciones-block, .descargo-block, .aclaraciones-block {
      background: #4CAF50;
      color: #fff;
      font-weight: bold;
      padding: 10px;
      text-align: center;
      border-radius: 4px;
      margin-top: 30px;
      margin-bottom: 0;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .observaciones-content, .descargo-content, .aclaraciones-content {
      background: #fff;
      color: #222;
      border: 1px solid #4CAF50;
      border-top: none;
      border-radius: 0 0 4px 4px;
      padding: 12px 18px;
      margin-bottom: 18px;
      text-align: justify;
    }
    .descargo-content ul, .aclaraciones-content ul {
      margin: 0;
      padding-left: 18px;
    }
    .descargo-content li, .aclaraciones-content li {
      margin-bottom: 6px;
    }
    .firmas-label {
      font-weight: bold;
      margin-bottom: 4px;
      margin-top: 10px;
    }
    .firmas-info {
      margin-bottom: 2px;
    }
    .historial-cambios-seccion {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <!-- Encabezado institucional -->
  <table style="width:100%; border:1px solid #222; border-collapse:collapse; margin-bottom:20px;">
    <tr>
      <td style="width:20%; border-bottom:1px solid #222; border-right:1px solid #222; text-align:center; vertical-align:middle;" rowspan="3">
        {{#if logoPath}}
          <img src="{{logoPath}}" style="width:80px; margin:10px 0;" />
        {{/if}}
      </td>
      <td style="width:65%; border-bottom:1px solid #222; text-align:center; font-weight:bold; color:#fff; background:#002D4D; font-size:12pt;" colspan="1">
        Laboratorio de análisis ambientales<br/>
        Centro de teleinformática y producción industrial
      </td>
      <td style="width:30%; border-bottom:1px solid #222; border-left:1px solid #222; font-size:10pt; padding:8px; text-align:center; vertical-align:middle;" rowspan="3">
        Código:<br/>LAA-F-047-03
    </td>
    </tr>
    <tr>
      <td style="border-bottom:1px solid #fcf4f4; text-align:center; color:#fff; background:#002D4D; font-size:11pt; font-weight:bold;" colspan="1">
        Informe de Resultados de Ensayos
      </td>
    </tr>
  </table>

  <div class="seccion">
    <div class="seccion-titulo">Información General</div>
    <table class="tabla">
      <tr><th>ID Muestra</th><td>{{resultado.idMuestra}}</td></tr>
      <tr><th>Estado</th><td>{{resultado.estado}}</td></tr>
      <tr><th>Verificado</th><td>{{#if resultado.verificado}}Sí{{else}}No{{/if}}</td></tr>
      <tr><th>Fecha de Recepción</th><td>{{resultado.createdAt.fecha}} {{resultado.createdAt.hora}}</td></tr>
      <tr><th>Última Actualización</th><td>{{resultado.updatedAt.fecha}} {{resultado.updatedAt.hora}}</td></tr>
    </table>
  </div>

  <div class="seccion">
    <div class="seccion-titulo">Información del Cliente</div>
    <table class="tabla">
      <tr><th>Nombre</th><td>{{resultado.cliente.nombre}}</td></tr>
      <tr><th>Documento</th><td>{{resultado.cliente.documento}}</td></tr>
      <tr><th>Dirección</th><td>{{resultado.cliente.direccion}}</td></tr>
      <tr><th>Teléfono</th><td>{{resultado.cliente.telefono}}</td></tr>
      <tr><th>Email</th><td>{{resultado.cliente.email}}</td></tr>
    </table>
  </div>

  <div class="seccion">
    <div class="seccion-titulo">Información de la Muestra</div>
    <table class="tabla">
      <tr><th>Tipo de Agua</th><td>{{resultado.tipoDeAgua.tipo}} ({{resultado.tipoDeAgua.descripcion}})</td></tr>
      <tr><th>Lugar de Muestreo</th><td>{{resultado.lugarMuestreo}}</td></tr>
      <tr><th>Fecha de Muestreo</th><td>{{resultado.fechaHoraMuestreo.fecha}} {{resultado.fechaHoraMuestreo.hora}}</td></tr>
      <tr><th>Tipo de Análisis</th><td>{{#if resultado.tipoAnalisis}}{{#each resultado.tipoAnalisis}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}{{else}}{{resultado.tipoAnalisis}}{{/if}}</td></tr>
    </table>
  </div>

  <div class="seccion">
    <div class="seccion-titulo">RESULTADOS DE ANÁLISIS</div>
    <div style="margin-bottom: 8px;">
      <b>Realizado por:</b> {{#if resultado.cambioVerificacion.nombre}}{{resultado.cambioVerificacion.nombre}}{{else}}No disponible{{/if}} |
      <b>Fecha:</b> {{#if resultado.cambioVerificacion.fechaFormateada}}{{resultado.cambioVerificacion.fechaFormateada}}{{/if}}
    </div>
    <div style="margin-bottom: 8px;">
      <b>Observaciones:</b> {{#if resultado.cambioVerificacion.observaciones}}{{resultado.cambioVerificacion.observaciones}}{{else}}Sin observaciones{{/if}}
    </div>
    <table class="tabla tabla-resultados">
      <thead>
        <tr>
          <th>ANÁLISIS</th>
          <th>UNIDAD</th>
          <th>VALOR</th>
          <th>MÉTODO</th>
          <th>TIPO</th>
        </tr>
      </thead>
      <tbody>
        {{#each resultado.resultadosArray}}
        <tr>
          <td>{{this.nombreFormateado}}</td>
          <td>{{this.unidad}}</td>
          <td>{{this.valor}}</td>
          <td>{{this.metodo}}</td>
          <td>{{this.tipo}}</td>
        </tr>
        {{else}}
        <tr><td colspan="5">No hay resultados de análisis.</td></tr>
        {{/each}}
      </tbody>
    </table>
  </div>

  {{#if resultado.historialCambiosReverso.length}}
  <!-- Salto de página antes del historial de cambios -->
  <div style="page-break-before: always"></div>
  <div class="seccion historial-cambios-seccion">
    <div class="seccion-titulo">HISTORIAL DE CAMBIOS</div>
    {{#each resultado.historialCambiosReverso}}
    <div class="cambio-detalle">
      <p><strong>CAMBIO #{{@indexPlusOne}}</strong></p>
      <p><strong>Realizado por:</strong> {{#if this.nombre}}{{this.nombre}}{{else}}No disponible{{/if}} | <strong>Fecha:</strong> {{this.fechaFormateada}}</p>
      <p><strong>Observaciones:</strong> {{#if this.observaciones}}{{this.observaciones}}{{else}}Sin observaciones{{/if}}</p>
      {{#if this.cambiosResultadosArray.length}}
      <table class="tabla">
        <thead>
          <tr>
            <th>Análisis</th>
            <th>Valor Anterior</th>
            <th>Valor Nuevo</th>
            <th>Unidad</th>
          </tr>
        </thead>
        <tbody>
          {{#each this.cambiosResultadosArray}}
          <tr>
            <td>{{this.parametro}}</td>
            <td>{{this.valorAnterior}}</td>
            <td>{{this.valorNuevo}}</td>
            <td>{{this.unidad}}</td>
          </tr>
          {{/each}}
        </tbody>
      </table>
      {{/if}}
    </div>
    {{/each}}
  </div>
  {{/if}}

  <!-- Salto de página para la última hoja -->
  <div style="page-break-before: always"></div>

  <!-- Observaciones -->
    <div class="observaciones-block">OBSERVACIONES</div>
    <div class="observaciones-content">
      Agradecemos el diligenciamiento de la siguiente encuesta de satisfacción: <a href="https://forms.office.com/r/ePtNQrxCMD">https://forms.office.com/r/ePtNQrxCMD</a>
    </div>

  <!-- Descargo de Responsabilidad / Disclaimers -->
    <div class="descargo-block">DESCARGO DE RESPONSABILIDAD</div>
    <div class="descargo-content">
      <ul>
        {{#each disclaimers}}
        <li>{{this}}</li>
        {{/each}}
      </ul>
    </div>

  <!-- Aclaraciones -->
    <div class="aclaraciones-block">ACLARACIONES</div>
    <div class="aclaraciones-content">
      <ul>
        {{#each clarifications}}
        <li>{{this}}</li>
        {{/each}}
      </ul>
    </div>

  <!-- Firmas -->
    <div class="firmas">
      <div class="firma-box">
        <div class="firmas-label">ELABORADO POR:</div>
        <div class="firmas-info">{{#if resultado.nombreLaboratorista}}{{resultado.nombreLaboratorista}}{{else}}N/A{{/if}}</div>
        <div class="firmas-info">Cédula: {{#if resultado.cedulaLaboratorista}}{{resultado.cedulaLaboratorista}}{{else}}N/A{{/if}}</div>
        <div class="firmas-info">ROL: Laboratorista</div>
      </div>
      <div class="firma-box">
        <div class="firmas-label">APROBADO POR:</div>
        <div class="firmas-info">{{#if aprobadorNombre}}{{aprobadorNombre}}{{else}}Director Técnico{{/if}}</div>
        <div class="firmas-info">Cédula: {{#if aprobadorCedula}}{{aprobadorCedula}}{{else}}N/A{{/if}}</div>
        <div class="firmas-info">ROL: Administrador</div>
      </div>
    </div>

  <!-- Fin del informe como título/bloque verde -->
    <div class="footer-block">FIN DEL INFORME DE ENSAYO</div>

  <!-- Contacto sin fondo verde, solo texto centrado y en mayúsculas -->
    <div style="text-align: center; margin-top: 10px; font-size: 10pt; text-transform: uppercase; color: #222;">
      LABORATORIO DE ANÁLISIS AMBIENTALES (a)<br>
      CARRERA 9 NÚMERO 71N - 60, POPAYÁN, CAUCA<br>
      CORREO ELECTRÓNICO: LABAMBIENTALCIP@SENA.EDU.CO<br>
      TELÉFONO / WHATSAPP: 324 6128123
    </div>
</body>
</html> 